
# ğŸ¹ STM32 Whac-A-Mole (æ‰“åœ°é¼ æ¸¸æˆ)

> äºšä¸œç§‘æŠ€å¤§å­¦æ¯•ä¸šä¸“é¢˜ | Asia Eastern University of Science and Technology Graduation Project

[![STM32](https://img.shields.io/badge/STM32-L053xx-blue)](https://www.st.com)
[![Build System](https://img.shields.io/badge/Build-CMake-orange)](https://cmake.org)

## ğŸ¯ å®ç°ç›®æ ‡

---
1. å½“ç³»ç»Ÿå¤ä½å LEDçŸ©é˜µ **å…¨äº®->å…¨ç­** åˆ‡æ¢é—´éš”ä¸º **500ms** å¹¶ä¸”å¾ªç¯ **3** æ¬¡ ç”¨äºæµ‹è¯•LEDçŸ©é˜µ
2. æ˜¾ç¤ºå››ä¸ªéšæœºæ•°å­—äºLEDçŸ©é˜µçš„ **4** ä¸ªè§’è½ ç”¨äºæµ‹è¯•å­—åº“
3. å½“ä¸Šè¿°æ˜¾ç¤ºå®Œæˆå æŒ‰ä¸‹é”®ç›˜ **0~9 #** æ—¶äºå±å¹• **å·¦ä¸Šæ–¹** æ˜¾ç¤ºå…¶å€¼ ç”¨äºæµ‹è¯•æŒ‰é”®
4. å¤„äºä¸Šè¿°çŠ¶æ€æ—¶ å½“æŒ‰ä¸‹ * æ—¶è¿›å…¥æ‰“åœ°é¼ æ¸¸æˆåˆå§‹UI
    1. åˆå§‹UIå®šä¹‰
        1. äº **å·¦ä¸Šè§’** æ˜¾ç¤º **8x8** #å­—æ¸¸æˆåœ°å›¾
        2. äºåæ ‡ **(10,6)(11,6) è‡³ (10,0)(11,0)** **åŒæ’ç”±ä¸Šè‡³ä¸‹** æ˜¾ç¤ºæ¸¸æˆå‰©ä½™æ—¶é—´
        3. äºåæ ‡ **(14,6)** **ç”±ä¸‹è‡³ä¸Š** é—´éš”**1**ä¸ªLED æ˜¾ç¤ºæ¸¸æˆéš¾åº¦ å…±**3**çº§
        4. äºåº•éƒ¨ **8x16**çš„èŒƒå›´å†…æ˜¾ç¤ºå¾—åˆ† é»˜è®¤ä¸º**00**
    2. æ¸¸æˆè®¾å®š
        1. æ¸¸æˆæ—¶é—´è®¾ç½®ä¸º **30** ç§’ æ¯ **5** ç§’æ‰ä¸€ä¸ªbar ç›´è‡³**æ¸¸æˆç»“æŸå…¨ç­**
        2. åœ°é¼ å°†ä»¥ **2x2** çš„å½¢å¼äº#å­—åœ°å›¾ä¸­å‡ºç° å¹¶ä¸”ä¸é”®ç›˜ä¸Šçš„ **1~9** ç›¸äº’å¯¹åº”
        3. å½“ç”¨æˆ·æŒ‰ä¸‹åœ°é¼ æ˜¾ç¤ºä½ç½®å¯¹åº”çš„é”®ç›˜æ•°å­—æ—¶å³å¾—1åˆ†
        4. å½“ç”¨æˆ·æŒ‰ä¸‹ * æ—¶ **æ¸¸æˆå¼€å§‹** å€’è®¡æ—¶ **30** ç§’ å¼€å§‹éšæœºåˆ·æ–°åœ°é¼ å¹¶è®¡åˆ†
        5. å½“**å€’è®¡æ—¶ä¸º0**æˆ–ç”¨æˆ·æŒ‰ä¸‹**é”®ç›˜0**æ—¶ æ¸¸æˆç»“æŸ å¾—åˆ†åŒºæ˜¾ç¤ºç›®å‰å¾—åˆ† å…¶ä½™å†…å®¹å¤ä½
        6. åœ¨æ¸¸æˆæœªå¼€å§‹ç”¨æˆ·æŒ‰ä¸‹ **#** æ—¶ å¯è°ƒæ•´æ¸¸æˆéš¾åº¦å…±ä¸º **3** ç§éš¾åº¦å¯¹åº”ä¸åŒçš„åœ°é¼ åˆ·æ–°é€Ÿåº¦

## ğŸ”© BOM

---
+ ***STM32L053R8Tx - NUCLEO-L053R8***(STM32å®˜æ–¹å¼€å‘æ¿)
+ ***LM154164XXX/LM154163XXX***(LED16x16çŸ©é˜µ)
+ ***3x4 keypad***
+ ***74HC244 & ULN2003A***(IOç¼“å†²å™¨)

## ğŸ”— IOå®šä¹‰

---
<details>
<summary>16*16 LED çŸ©é˜µ</summary>

| **PORT** | **IO** | **åŠŸèƒ½**   | **æ³¨é‡Š**     |
|----------|--------|----------|------------|
| PA       | 0      | LedM-R1  | è¡Œ1/Output  |
| PA       | 1      | LedM-R2  | è¡Œ2/Output  |
| PC       | 7      | LedM-R3  | è¡Œ3/Output  |
| PC       | 10     | LedM-R4  | è¡Œ4/Output  |
| PA       | 4      | LedM-R5  | è¡Œ5/Output  |
| PA       | 5      | LedM-R6  | è¡Œ6/Output  |
| PA       | 6      | LedM-R7  | è¡Œ7/Output  |
| PA       | 7      | LedM-R8  | è¡Œ8/Output  |
| PA       | 8      | LedM-R9  | è¡Œ9/Output  |
| PA       | 9      | LedM-R10 | è¡Œ10/Output |
| PA       | 10     | LedM-R11 | è¡Œ11/Output |
| PA       | 11     | LedM-R12 | è¡Œ12/Output |
| PA       | 12     | LedM-R13 | è¡Œ13/Output |
| PC       | 11     | LedM-R14 | è¡Œ14/Output |
| PC       | 12     | LedM-R15 | è¡Œ15/Output |
| PA       | 15     | LedM-R16 | è¡Œ16/Output |
|          |        |          |            |
| PB       | 0      | LedM-C1  | åˆ—1/Output  |
| PB       | 1      | LedM-C2  | åˆ—2/Output  |
| PB       | 2      | LedM-C3  | åˆ—3/Output  |
| PD       | 2      | LedM-C4  | åˆ—4/Output  |
| PB       | 4      | LedM-C5  | åˆ—5/Output  |
| PB       | 5      | LedM-C6  | åˆ—6/Output  |
| PB       | 6      | LedM-C7  | åˆ—7/Output  |
| PB       | 7      | LedM-C8  | åˆ—8/Output  |
| PB       | 8      | LedM-C9  | åˆ—9/Output  |
| PB       | 9      | LedM-C10 | åˆ—10/Output |
| PB       | 10     | LedM-C11 | åˆ—11/Output |
| PB       | 11     | LedM-C12 | åˆ—12/Output |
| PB       | 12     | LedM-C13 | åˆ—13/Output |
| PB       | 13     | LedM-C14 | åˆ—14/Output |
| PB       | 14     | LedM-C15 | åˆ—15/Output |
| PB       | 15     | LedM-C16 | åˆ—16/Output |
</details>

<details>
<summary>3x4é”®ç›˜</summary>

| **PORT** | **IO** | **åŠŸèƒ½** | **æ³¨é‡Š**         |
|----------|--------|--------|----------------|
| PC       | 0      | Key-R0 | è¡Œ0/Output      |
| PC       | 1      | Key-R1 | è¡Œ1/Output      |
| PC       | 2      | Key-R2 | è¡Œ2/Output      |
| PC       | 3      | Key-R3 | è¡Œ3/Output      |
| PC       | 4      | Key-C0 | åˆ—0/Input/EXTI4 |
| PC       | 5      | Key-C1 | åˆ—1/Input/EXT5  |
| PC       | 6      | Key-C2 | åˆ—2/Input/EXTI6 |
</details>

<details>
<summary>ç¼“å†²å™¨</summary>

| **PORT** | **IO** | **åŠŸèƒ½** | **æ³¨é‡Š**                     |
|----------|--------|--------|----------------------------|
| PC       | 8      | BFOE-1 | 74HC245 çº¿è·¯ç¼“å†²å™¨ä½¿èƒ½ é€šè·¯1/Output |
| PC       | 9      | BFOE-2 | 74HC245 çº¿è·¯ç¼“å†²å™¨ä½¿èƒ½ é€šè·¯2/Output |
</details>

## ğŸ“ åŸç†å›¾

---
![åŸç†å›¾](./docs/image/Schematic%20diagram01.jpg)

## ğŸ“‚ é¡¹ç›®ç»“æ„

---
```ruby            
Core/                            # æ ¸å¿ƒä»£ç 
â”œâ”€â”€ Inc/                         # å¤´æ–‡ä»¶
â”‚   â”œâ”€â”€ basic_graphics_driver.h    # åŸºç¡€æ˜¾ç¤ºé©±åŠ¨
â”‚   â”œâ”€â”€ led_matrix_driver.h        # LEDçŸ©é˜µé©±åŠ¨
â”‚   â”œâ”€â”€ keyboard_driver.h          # é”®ç›˜é©±åŠ¨
â”‚   â”œâ”€â”€ tool.h                     # å·¥å…·
â”‚   â””â”€â”€ game.h                     # æ¸¸æˆå†…å®¹
â””â”€â”€ Src/                         # æºæ–‡ä»¶
```

## ğŸ“‘ API æ¥å£è¯´æ˜

---
### ğŸ“º åŸºç¡€å›¾å½¢é©±åŠ¨ (`basic_graphics_driver.h`)

| **åŠŸèƒ½åˆ†ç±»** | **å‡½æ•°åŸå‹**                                                 | **è¿”å›å€¼**  | **è¯´æ˜**                     |
|----------|----------------------------------------------------------|----------|----------------------------|
| **ç»“æ„å®šä¹‰** | `screen_buffer[16]`                                      |          | å±å¹•åˆ·æ–°ç¼“å†²(æ˜¾å­˜)                 |
| **åŸºç¡€æ“ä½œ** | `screen_clear()`                                         | void     | æ¸…ç©ºå±å¹•ç¼“å†²åŒº                    |
|          | `screen_fill()`                                          | void     | å¡«æ»¡å±å¹•ç¼“å†²åŒº                    |
| **åƒç´ æ§åˆ¶** | `screen_clear_specified(x, y, w, h)`                     | void     | æ¸…ç©ºæŒ‡å®šåŒºåŸŸåƒç´                    |
|          | `screen_set_pixel(x, y, bit)`                            | void     | è®¾ç½®æŒ‡å®šä½ç½®åƒç´ å†…å®¹(0/1)            |
|          | `screen_draw_pixel(x, y)`                                | void     | ç‚¹äº®æŒ‡å®šåƒç´                      |
|          | `screen_clear_pixel(x, y)`                               | void     | æ¸…ç©ºæŒ‡å®šåƒç´                      |
| **å›¾å½¢ç»˜åˆ¶** | `screen_draw_line(x0, y0, x1, y1)`                       | void     | ç»˜åˆ¶(x0, y0)ä¸(x1, y1)ä¹‹é—´çš„çº¿    |
|          | `screen_draw_rectangle(x0, y0, x1, y1)`                  | void     | ç»˜åˆ¶(x0, y0)ä¸(x1, y1)ä¹‹é—´çš„ç©ºå¿ƒçŸ©å½¢ |
|          | `screen_fill_rectangle(x0, y0, x1, y1)`                  | void     | ç»˜åˆ¶(x0, y0)ä¸(x1, y1)ä¹‹é—´çš„å®å¿ƒçŸ©å½¢ |
| **æ˜¾å­˜æ“ä½œ** | `screen_push_data_u8(x, y, *data, len, cover)`           | void     | æ¨é€ 8-bit æ•°æ®å— (æ¨ªå‘)          |
|          | `screen_push_data_u16(x, y, *data, len, cover)`          | void     | æ¨é€ 16-bit æ•°æ®å— (æ¨ªå‘)         |
|          | `screen_push_data_u8_vertical(x, y, *data, len, cover)`  | void     | æ¨é€ 8-bit æ•°æ®å— (å‚ç›´)          |
|          | `screen_push_data_u16_vertical(x, y, *data, len, cover)` | void     | æ¨é€ 16-bit æ•°æ®å— (å‚ç›´)         |
| **è¾…åŠ©å‡½æ•°** | `reverse_bits_u8(n)`                                     | uint8_t  | åè½¬8-bit                    |
|          | `reverse_bits_u16(n)`                                    | uint16_t | åè½¬16-bit                   |
|          | `screen_show()`                                          | void     | ç”¨æˆ·å®ç°å±å¹•åˆ·æ–°                   |


### ğŸ“º LEDçŸ©é˜µå±é©±åŠ¨ (`led_matrix_driver.h`)
| **åŠŸèƒ½åˆ†ç±»** | **å‡½æ•°åŸå‹**                         | **è¿”å›å€¼** | **è¯´æ˜**                                        |
|----------|----------------------------------|---------|-----------------------------------------------|
| **åˆå§‹åŒ–**  | `led_matrix_init()`              | void    | LEDçŸ©é˜µå±åˆå§‹åŒ–                                     |
| **é©±åŠ¨å®ç°** | `led_matrix_scan_vertical(*buf)` | void    | å°†æ•°æ®æ¨é€åˆ°LEDçŸ©é˜µå±ä¸Š(æ¯æ¬¡ä¸€è¡Œ)                           |
| **è¾…åŠ©å‡½æ•°** | `led_matrix_init_lut()`          | void    | åˆå§‹åŒ–LEDçŸ©é˜µIOå¯„å­˜å™¨æ˜ å°„è¡¨                              |




### âŒ¨ï¸ é”®ç›˜é©±åŠ¨ (`keyboard_driver.h`)
| åŠŸèƒ½åˆ†ç±»     | å‡½æ•°åŸå‹                                                                                                                | è¿”å›å€¼     | è¯´æ˜            |
|----------|---------------------------------------------------------------------------------------------------------------------|---------|---------------|
| **é©±åŠ¨å®ç°** | `keyboard_scan()`                                                                                                   | void    | é”®ç›˜æ‰«æ          |
| **äº‹ä»¶å›è°ƒ** | `keyboard_EXTI_callback(GPIO_Pin)`                                                                                  | void    | é”®ç›˜æ‰«æä¸­æ–­å›è°ƒ      |
| **å–å€¼è§£æ** | `get_keyboard_currently_pressed_char()`                                                                             | char    | è·å–å½“å‰é”®ç›˜æŒ‰ä¸‹æ‰€æ˜ å°„å­—ç¬¦ |
|          | `get_keyboard_currently_pressed_number()`                                                                           | uint8_t | è·å–å½“å‰é”®ç›˜æŒ‰ä¸‹æ‰€æ˜ å°„æ•°å­— |

### ğŸ² æ¸¸æˆæ ¸å¿ƒ (`game.h`)
| åŠŸèƒ½åˆ†ç±»     | å‡½æ•°åŸå‹                                          | è¿”å›å€¼  | è¯´æ˜          |
|----------|-----------------------------------------------|------|-------------|
| **æ¸¸æˆå†…å®¹** | `game()`                                      | void | è¿è¡Œæ¸¸æˆå…¥å£      |
|          | `game_mode_0() ~ game_mode_3()`               | void | æ¸¸æˆé˜¶æ®µå…¥å£      |
|          | `play_whack_a_mole(game_config, game_status)` | void | æ‰“åœ°é¼ æ¸¸æˆå…¥å£     |
| **é©±åŠ¨æ ¸å¿ƒ** | `play_whack_a_mole_tick()`                    | void | æ‰“åœ°é¼ æ¸¸æˆ æ—¶é—´åˆ»å›è°ƒ |
|          | `random_gopher(game_status)`                  | void | åˆ·æ–°åœ°é¼         |
|          | `set_game_level(game_config, level)`          | void | è®¾ç½®æ¸¸æˆéš¾åº¦      |
|          | `rset_game_struct(game_status)`               | void | é‡ç½®æ¸¸æˆçŠ¶æ€      |
| **æ¸¸æˆæ¸²æŸ“** | `show_game_map_and_gopher(i)`                 | void | ç»˜åˆ¶æ¸¸æˆåœ°å›¾åŠåœ°é¼    |
|          | `show_game_time(time)`                        | void | ç»˜åˆ¶æ¸¸æˆå‰©ä½™æ—¶é—´    |
|          | `show_game_level(level)`                      | void | ç»˜åˆ¶æ¸¸æˆå½“å‰éš¾åº¦    |
|          | `show_game_score(score)`                      | void | ç»˜åˆ¶æ¸¸æˆå½“å‰å¾—åˆ†    |

### ğŸ§° è¾…åŠ©å‡½æ•°(`tool.h`)
| åŠŸèƒ½åˆ†ç±»    | å‡½æ•°åŸå‹                    | è¿”å›å€¼      | è¯´æ˜                  |
|---------|-------------------------|----------|---------------------|
| **å®å®šä¹‰** | SET_PIN_HIGH(port, pin) |          | è·å–å¼€å¯æŒ‡å®šPORT PINçš„å¯„å­˜å™¨å€¼ |
|         | SET_PIN_LOW(port, pin)  |          | è·å–å…³é—­æŒ‡å®šPORT PINçš„å¯„å­˜å™¨å€¼ |
| **å‡½æ•°**  | RNG_GetRange(min, max)  | uint32_t | è·å–[min~max]ä¹‹é—´çš„éšæœºæ•°   |

# ğŸï¸ å±•ç¤º

---
